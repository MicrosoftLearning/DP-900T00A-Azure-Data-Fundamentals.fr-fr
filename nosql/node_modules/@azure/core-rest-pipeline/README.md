---
ms.openlocfilehash: 6f2950dcb9eebd8a8a946f99370300d10624b1c2
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053032"
---
# <a name="azure-core-http-client-library-for-javascript-experimental"></a>Bibliothèque cliente HTTP Azure Core pour JavaScript (expérimentale)

Il s’agit du principal pipeline HTTP pour les bibliothèques JavaScript du SDK Azure qui fonctionnent dans le navigateur et Node.js. Cette bibliothèque est principalement destinée à être utilisée dans le code généré par [AutoRest](https://github.com/Azure/Autorest) et [`autorest.typescript`](https://github.com/Azure/autorest.typescript).

## <a name="getting-started"></a>Prise en main

### <a name="requirements"></a>Spécifications

### <a name="currently-supported-environments"></a>Environnements actuellement pris en charge

- [Versions LTS de Node.js](https://nodejs.org/about/releases/)
- Dernières versions de Safari, Chrome, Edge et Firefox.

Pour plus d’informations, consultez notre [politique de support](https://github.com/Azure/azure-sdk-for-js/blob/main/SUPPORT.md) .

### <a name="installation"></a>Installation

Ce package est principalement utilisé dans le code généré ; il n’est pas destiné à être consommé directement par les utilisateurs finaux.

## <a name="key-concepts"></a>Concepts clés

### <a name="pipelinerequest"></a>PipelineRequest

Un `PipelineRequest` décrit toutes les informations nécessaires pour effectuer une requête sur un point de terminaison REST HTTP.

### <a name="pipelineresponse"></a>PipelineResponse

Un `PipelineResponse` décrit la réponse HTTP (corps, en-têtes et code d’état) qu’un point de terminaison REST a retournée à la suite d’une requête HTTP.

### <a name="sendrequest"></a>SendRequest

Une méthode `SendRequest` est une méthode qui, à partir d’un `PipelineRequest` donné, peut retourner de manière asynchrone un `PipelineResponse`.

```ts
export type SendRequest = (request: PipelineRequest) => Promise<PipelineResponse>;
```

### <a name="httpclient"></a>HttpClient

Un `HttpClient` est un objet qui satisfait à l’interface suivante pour implémenter une méthode `SendRequest` :

```ts
export interface HttpClient {
  /**
   * The method that makes the request and returns a response.
   */
  sendRequest: SendRequest;
}
```

Les `HttpClient` doivent en principe effectuer la requête HTTP sur un point de terminaison de serveur au moyen d’un mécanisme propre à la plateforme.

### <a name="pipeline-policies"></a>Stratégies de pipeline

Un `PipelinePolicy` est un objet simple qui implémente l’interface suivante :

```ts
export interface PipelinePolicy {
  /**
   * The policy name. Must be a unique string in the pipeline.
   */
  name: string;
  /**
   * The main method to implement that manipulates a request/response.
   * @param request The request being performed.
   * @param next The next policy in the pipeline. Must be called to continue the pipeline.
   */
  sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse>;
}
```

Sa forme est similaire à `HttpClient`, mais il inclut un nom de stratégie ainsi qu’une signature `SendRequest` légèrement modifiée qui lui permet d’appeler sous conditions la stratégie suivante dans le pipeline.

On peut voir le rôle des stratégies comme celui d’un `middleware`, un concept qui est familié aux développeurs NodeJS ayant déjà travaillé avec des frameworks tels qu’[Express](https://expressjs.com/).

L’implémentation de `sendRequest` peut transformer la requête sortante ainsi que la réponse entrante :

```ts
const customPolicy = {
  name: "My wonderful policy",
  async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {
    // Change the outgoing request by adding a new header
    request.headers.set("X-Cool-Header", 42);
    const result = await next(request);
    if (response.status === 403) {
      // Do something special if this policy sees Forbidden
    }
    return result;
  }
};
```

La plupart des stratégies se préoccupent uniquement soit de la requête, soit de la réponse. Il existe toutefois des exceptions, comme [LogPolicy](https://github.com/Azure/azure-sdk-for-js/blob/main/sdk/core/core-rest-pipeline/src/policies/logPolicy.ts) qui enregistre les informations de l’une et de l’autre.

### <a name="pipelines"></a>Pipelines

Un `Pipeline` est un objet qui gère un ensemble d’objets `PipelinePolicy`. Sa fonction principale est de s’assurer que les stratégies sont exécutées dans un ordre cohérent et prévisible.

Vous pouvez voir les stratégies appliquées comme une sorte de pile (première entrée, première sortie). Le premier `PipelinePolicy` peut modifier le `PipelineRequest` avant les autres stratégies. Il est aussi le dernier à modifier le `PipelineResponse`, ce qui le rend le plus proche de l’appelant. La stratégie finale est la dernière en mesure de modifier la requête sortante et la première à traiter la réponse, ce qui en fait la plus proche du réseau.

Un `Pipeline` satisfait à l’interface suivante :

```ts
export interface Pipeline {
  addPolicy(policy: PipelinePolicy, options?: AddPolicyOptions): void;
  removePolicy(options: { name?: string; phase?: PipelinePhase }): PipelinePolicy[];
  sendRequest(httpClient: HttpClient, request: PipelineRequest): Promise<PipelineResponse>;
  getOrderedPolicies(): PipelinePolicy[];
  clone(): Pipeline;
}
```

Comme vous pouvez le voir, il permet l’ajout et la suppression de stratégies, et il est faiblement couplé avec `HttpClient` pour effectuer la requête réelle sur le point de terminaison de serveur.

Un concept important à noter au sujet des `Pipeline` est qu’ils regroupent les stratégies en phases ordonnées :

1. Phase de sérialisation
2. Stratégies hors phase
3. Phase de désérialisation
4. Phase de nouvelle tentative

Les phases se déroulent dans l’ordre ci-dessus, sachant que les stratégies de sérialisation sont appliquées en premier et les stratégies de nouvelle tentative sont appliquées en dernier. La plupart des stratégies personnalisées entrent dans la deuxième catégorie et ne reçoivent pas de nom de phase.

Quand vous ajoutez une stratégie au pipeline, vous pouvez spécifier la phase dans laquelle la stratégie se trouve, mais également si elle a des dépendances :

```ts
export interface AddPolicyOptions {
  beforePolicies?: string[];
  afterPolicies?: string[];
  afterPhase?: PipelinePhase;
  phase?: PipelinePhase;
}
```

Les `beforePolicies` sont des stratégies que la nouvelle stratégie doit exécuter avant et les `afterPolicies` sont des stratégies que la nouvelle stratégie doit exécuter après. De même, `afterPhase` signifie que la stratégie doit s’exécuter seulement après que la phase spécifiée a eu lieu.

Avec cette syntaxe, les auteurs de stratégies personnalisés peuvent exprimer toutes les relations nécessaires entre leurs propres stratégies et les stratégies intégrées fournies par `@azure/core-rest-pipeline` lors de la création d’un pipeline avec `createPipelineFromOptions`.

Ceux qui implémentent les stratégies sont également en mesure de supprimer des stratégies par nom ou par phase, ce qui leur permet de modifier un `Pipeline` existant sans avoir à en créer un autre avec `createEmptyPipeline`. La méthode `clone` est particulièrement utile pour recréer un `Pipeline` sans modifier l’original.

Une fois que toutes les autres contraintes ont été satisfaites, les stratégies sont appliquées dans l’ordre dans lequel elles ont été ajoutées.

## <a name="examples"></a>Exemples

Vous trouverez des exemples dans le dossier `samples`.

## <a name="next-steps"></a>Étapes suivantes

Vous pouvez générer et exécuter les tests localement en exécutant `rushx test`. Explorez le dossier `test` pour voir l’utilisation et le comportement avancés des classes publiques.

## <a name="troubleshooting"></a>Résolution des problèmes

Si vous rencontrez des problèmes lors de l’utilisation de cette bibliothèque, n’hésitez pas à [signaler un problème](https://github.com/Azure/azure-sdk-for-js/issues/new).

## <a name="contributing"></a>Contribution

Si vous souhaitez contribuer à cette bibliothèque, lisez le [guide de contribution](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) pour en savoir plus sur la génération et le test du code.

![Impressions](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcore%2Fcore-rest-pipeline%2FREADME.png)
