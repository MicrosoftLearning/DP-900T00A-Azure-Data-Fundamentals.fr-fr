---
ms.openlocfilehash: 3e62289181d994a0e786bb53417f576ac1a3059b
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051537"
---
# <a name="azure-cosmos-db-client-library-for-javascripttypescript"></a>Bibliothèque cliente Azure Cosmos DB pour JavaScript/TypeScript

[![badge npm le plus récent](https://img.shields.io/npm/v/%40azure%2Fcosmos/latest.svg)][npm]
[![État de la build](https://dev.azure.com/azure-sdk/public/_apis/build/status/js/js%20-%20cosmosdb%20-%20ci?branchName=main)](https://dev.azure.com/azure-sdk/public/_build/latest?definitionId=850&branchName=main)

Azure Cosmos DB est un service de base de données multimodèle globalement distribué qui prend en charge les bases de données de documents, de valeurs clés, à colonne large et de graphiques. Ce package est conçu pour les applications JavaScript/TypeScript qui doivent interagir avec des bases de données **API SQL** et les documents JSON qu’elles contiennent :

- Créer des bases de données Cosmos DB et modifier leurs paramètres
- Créer et modifier des conteneurs pour y stocker des collections de documents JSON
- Créer, lire, mettre à jour et supprimer des éléments (documents JSON) dans vos conteneurs
- Interroger les documents dans votre base de données avec une syntaxe de type SQL

Liens clés :

- [Package (npm)][npm]
- [Documentation de référence de l’API](https://docs.microsoft.com/javascript/api/@azure/cosmos/?view=azure-node-lates)
- [Documentation du produit][cosmos_docs]

## <a name="getting-started"></a>Prise en main

### <a name="prerequisites"></a>Prérequis

#### <a name="azure-subscription-and-cosmos-db-sql-api-account"></a>Abonnement Azure et compte API SQL Cosmos DB

Vous devez avoir un [abonnement Azure][azure_sub] et un [compte Cosmos DB][cosmos_account] (API SQL) pour utiliser ce package.

Si vous n’avez pas encore de compte API SQL Cosmos DB, vous pouvez utiliser Azure [Cloud Shell][cloud_shell_bash] pour en créer un, en utilisant cette commande Azure CLI :

```Bash
az cosmosdb create --resource-group <resource-group-name> --name <cosmos-database-account-name>
```

Vous pouvez aussi créer un compte dans le [portail Azure](https://portal.azure.com/#create/microsoft.documentdb).

#### <a name="nodejs"></a>NodeJS

Ce package est distribué via [npm][npm], qui est préinstallé avec [NodeJS](https://nodejs.org/en/). Vous avez besoin de Node version 10 ou ultérieure.

#### <a name="cors"></a>CORS

Vous devez configurer des règles [CORS (Cross-Origin Resource Sharing)](https://docs.microsoft.com/azure/cosmos-db/how-to-configure-cross-origin-resource-sharing) pour votre compte Cosmos DB si votre développement est destiné à des navigateurs. Suivez les instructions fournies dans le document du lien pour créer des règles CORS pour votre compte Cosmos DB.

### <a name="install-this-package"></a>Installer ce package

```Bash
npm install @azure/cosmos
```

### <a name="get-account-credentials"></a>Obtenir les informations d’identification du compte

Vous aurez besoin de fournir le **point de terminaison du compte** Cosmos DB et la **clé** associée. Pour obtenir ces informations, recherchez-les dans le [portail Azure](https://portal.azure.com/#blade/hubsextension/browseresource/resourcetype/microsoft.documentdb%2fdatabaseaccounts) ou utilisez l’extrait de code [Azure CLI][azure_cli] ci-dessous. L’extrait de code est mis en forme pour l’interpréteur de commandes Bash.

```Bash
az cosmosdb show --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
az cosmosdb keys list --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
```

### <a name="create-an-instance-of-cosmosclient"></a>Créer une instance de `CosmosClient`

L’interaction avec Cosmos DB commence par une instance de la classe [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)

```js
const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://your-account.documents.azure.com";
const key = "<database account masterkey>";
const client = new CosmosClient({ endpoint, key });

async function main() {
  // The rest of the README samples are designed to be pasted into this function body
}

main().catch((error) => {
  console.error(error);
});
```

Par souci de simplicité, nous avons inclus les informations `key` et `endpoint` directement dans le code. Si vous souhaitez les charger à partir d’un fichier hors du contrôle de code source, utilisez un projet comme [dotenv](https://www.npmjs.com/package/dotenv) ou chargez-les des variables d’environnement

Dans les environnements de production, les secrets tels que les clés doivent être stockés dans [Azure Key Vault](https://azure.microsoft.com/services/key-vault/)

## <a name="key-concepts"></a>Concepts clés

Une fois que vous avez initialisé un [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-lates), vous pouvez interagir avec les principaux types de ressources dans Cosmos DB :

- [Base de données](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) : un compte Cosmos DB peut contenir plusieurs bases de données. Quand vous créez une base de données, vous spécifiez l’API que vous voulez utiliser pour l’interaction avec ses documents : SQL, MongoDB, Gremlin, Cassandra ou Azure Table. Utilisez l’objet [Database](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) pour gérer ses conteneurs.

- [Conteneur](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest) : un conteneur est une collection de documents JSON. Vous créez (insérez), lisez, mettez à jour et supprimez des éléments dans un conteneur en utilisant des méthodes sur l’objet [Container](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest).

- [Item](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest): un élément est un document JSON stocké dans un conteneur. Chaque élément doit inclure une clé `id` dont la valeur identifie de manière unique l’élément dans le conteneur. Si vous ne fournissez pas de clé `id`, le SDK en génère une automatiquement.

Pour plus d’informations sur ces ressources, consultez [Utilisation des bases de données, des conteneurs et des éléments Azure Cosmos][cosmos_resources].

## <a name="examples"></a>Exemples

Les sections suivantes fournissent plusieurs extraits de code qui couvrent quelques-unes des tâches Cosmos DB les plus courantes, notamment :

- [Créer une base de données](#create-a-database)
- [Créer un conteneur](#create-a-container)
- [Insérer des éléments](#insert-items)
- [Interroger des documents](#query-the-database)
- [Lire un élément](#read-an-item)
- [Supprimer un élément](#delete-an-data)

### <a name="create-a-database"></a>Création d'une base de données

Après avoir authentifié votre [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest), vous pouvez utiliser n’importe quelle ressource dans le compte. L’extrait de code ci-dessous crée une base de données API SQL.

```js
const { database } = await client.databases.createIfNotExists({ id: "Test Database" });
console.log(database.id);
```

### <a name="create-a-container"></a>Créez un conteneur.

Cet exemple crée un conteneur avec les paramètres par défaut

```js
const { container } = await database.containers.createIfNotExists({ id: "Test Database" });
console.log(container.id);
```

### <a name="insert-items"></a>Insérer des éléments

Pour insérer des éléments dans un conteneur, transmettez un objet contenant vos données à [Items.upsert](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#upsert-t--requestoptions-). Le service Cosmos DB requiert une clé `id` pour chaque élément. Si vous ne fournissez pas de clé `id`, le SDK en génère une automatiquement.

Cet exemple insère plusieurs éléments dans le conteneur

```js
const cities = [
  { id: "1", name: "Olympia", state: "WA", isCapitol: true },
  { id: "2", name: "Redmond", state: "WA", isCapitol: false },
  { id: "3", name: "Chicago", state: "IL", isCapitol: false }
];
for (const city of cities) {
  container.items.create(city);
}
```

### <a name="read-an-item"></a>Lire un élément

Pour lire un seul élément d’un conteneur, utilisez [Item.read](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#read-requestoptions-). Cette opération consomme moins de ressources que l’utilisation de SQL pour interroger par `id`.

```js
await container.item("1").read();
```

### <a name="delete-an-item"></a>Supprimer un élément

Pour supprimer des éléments d’un conteneur, utilisez [Item.delete](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#delete-requestoptions-).

```js
// Delete the first item returned by the query above
await container.item("1").delete();
```

### <a name="query-the-database"></a>Interroger la base de données

Une base de données API SQL Cosmos DB prend en charge l’interrogation des éléments dans un conteneur avec une requête [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-) utilisant une syntaxe de type SQL :

```js
const { resources } = await container.items
  .query("SELECT * from c WHERE c.isCapitol = true")
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Effectuez des requêtes paramétrables en transmettant un objet contenant les paramètres et leurs valeurs à [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-) :

```js
const { resources } = await container.items
  .query({
    query: "SELECT * from c WHERE c.isCapitol = @isCapitol",
    parameters: [{ name: "@isCapitol", value: true }]
  })
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Pour plus d’informations sur l’interrogation des bases de données Cosmos DB avec l’API SQL, consultez [Interroger des données Azure Cosmos DB avec des requêtes SQL][cosmos_sql_queries].

## <a name="troubleshooting"></a>Dépannage

### <a name="general"></a>Général

Quand vous interagissez avec Cosmos DB, les erreurs retournées par le service correspondent aux codes d’état HTTP retournés pour les requêtes d’API REST :

[Codes d’état HTTP pour Azure Cosmos DB][cosmos_http_status_codes]

#### <a name="conflicts"></a>Conflits

Par exemple, si vous essayez de créer un élément avec un `id` qui est déjà utilisé dans votre base de données Cosmos DB, une erreur `409` est retournée, indiquant le conflit. Dans l’extrait suivant, l’erreur est prise en charge correctement via l’interception de l’exception et l’affichage d’informations supplémentaires sur l’erreur en question.

```js
try {
  await containers.items.create({ id: "existing-item-id" });
} catch (error) {
  if (error.code === 409) {
    console.log("There was a conflict with an existing item");
  }
}
```

### <a name="transpiling"></a>Transpilation

Les SDK Azure sont conçus pour prendre en charge la syntaxe JavaScript ES5 et les [versions LTS de Node.js](https://nodejs.org/about/releases/). Si vous avez besoin d’une prise en charge de runtimes JavaScript antérieurs tels qu’Internet Explorer ou Node 6, vous devez transpiler le code des SDK dans le cadre de votre processus de build.

### <a name="handle-transient-errors-with-retries"></a>Gérer les erreurs temporaires avec de nouvelles tentatives

Quand vous utilisez Cosmos DB, vous pouvez rencontrer des défaillances temporaires causées par des [limites du taux de transfert][cosmos_request_units] appliquées par le service ou d’autres problèmes passagers comme des pannes du réseau. Pour plus d’informations sur la gestion de ces types d’échecs, consultez le [modèle Nouvelle tentative][azure_pattern_retry] dans le guide des modèles de conception de cloud et le [modèle Disjoncteur][azure_pattern_circuit_breaker] connexe.

## <a name="next-steps"></a>Étapes suivantes

### <a name="more-sample-code"></a>Autres exemples de code

[Plusieurs exemples][cosmos_samples] sont disponibles dans le dépôt GitHub du SDK. Vous y trouverez des exemples de code pour d’autres scénarios fréquents associés à l’utilisation du service Cosmos DB :

- Opérations de base de données
- Opérations sur le conteneur
- Opérations d'élément
- Configuration de l’indexation
- Lecture d’un flux de modification de conteneur
- Procédures stockées
- Modification des paramètres de débit de base de données/conteneur
- Opérations d’écriture multirégion

### <a name="additional-documentation"></a>Documentation complémentaire

Pour une documentation plus complète sur le service Cosmos DB, consultez la [documentation du service Cosmos DB][cosmos_docs] sur docs.microsoft.com.

## <a name="useful-links"></a>Liens utiles

- [Bienvenue dans Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/community)
- [Démarrage rapide](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-get-started)
- [Didacticiel](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-application)
- [Exemples](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples)
- [Présentation du modèle de ressource du service Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-resources)
- [Présentation de l’API SQL du service Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-sql-query)
- [Partitionnement](https://docs.microsoft.com/azure/cosmos-db/sql-api-partition-data)
- [Documentation de l’API](https://docs.microsoft.com/javascript/api/%40azure/cosmos/?view=azure-node-latest)

## <a name="contributing"></a>Contribution

Si vous souhaitez contribuer à cette bibliothèque, lisez le [guide de contribution](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) pour en savoir plus sur la génération et le test du code.

![Impressions](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcosmosdb%2Fcosmos%2FREADME.png)

<!-- LINKS -->

[azure_cli]: https://docs.microsoft.com/cli/azure
[azure_pattern_circuit_breaker]: https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker
[azure_pattern_retry]: https://docs.microsoft.com/azure/architecture/patterns/retry
[azure_portal]: https://portal.azure.com
[azure_sub]: https://azure.microsoft.com/free/
[cloud_shell]: https://docs.microsoft.com/azure/cloud-shell/overview
[cloud_shell_bash]: https://shell.azure.com/bash
[cosmos_account_create]: https://docs.microsoft.com/azure/cosmos-db/how-to-manage-database-account
[cosmos_account]: https://docs.microsoft.com/azure/cosmos-db/account-overview
[cosmos_container]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-containers
[cosmos_database]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-databases
[cosmos_docs]: https://docs.microsoft.com/azure/cosmos-db/
[cosmos_http_status_codes]: https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb
[cosmos_item]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-items
[cosmos_request_units]: https://docs.microsoft.com/azure/cosmos-db/request-units
[cosmos_resources]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items
[cosmos_samples]: https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples
[cosmos_sql_queries]: https://docs.microsoft.com/azure/cosmos-db/how-to-sql-query
[cosmos_ttl]: https://docs.microsoft.com/azure/cosmos-db/time-to-live
[npm]: https://www.npmjs.com/package/@azure/cosmos
