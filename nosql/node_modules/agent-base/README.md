---
ms.openlocfilehash: ca1f677bd38876befee833fcedd10388a71aecf4
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053024"
---
<a name="agent-base"></a>agent-base
==========
### <a name="turn-a-function-into-an-httpagenthttpagent-instance"></a>Transformez une fonction en instance [`http.Agent`][http.Agent]
[![État de la build](https://github.com/TooTallNate/node-agent-base/workflows/Node%20CI/badge.svg)](https://github.com/TooTallNate/node-agent-base/actions?workflow=Node+CI)

Ce module fournit un générateur `http.Agent`. Autrement dit, vous passez une fonction de rappel asynchrone et celle-ci retourne une nouvelle instance `http.Agent` qui appellera la fonction de rappel donnée au moment de l’envoi des requêtes HTTP sortantes.

#### <a name="some-subclasses"></a>Voici quelques sous-classes :

Voici des exemples d’utilisations de `agent-base` plus intéressantes.
Envoyez une requête de tirage (pull request) pour lister les vôtres !

 * [`http-proxy-agent`][http-proxy-agent] : Implémentation de l’instance `http.Agent` du proxy HTTP(s) pour les points de terminaison HTTP
 * [`https-proxy-agent`][https-proxy-agent] : Implémentation de l’instance `http.Agent` du proxy HTTP(s) pour les points de terminaison HTTPS
 * [`pac-proxy-agent`][pac-proxy-agent] : Implémentation de l’instance `http.Agent` du proxy de fichiers PAC pour HTTP et HTTPS
 * [`socks-proxy-agent`][socks-proxy-agent] : Implémentation de l’instance `http.Agent` du proxy SOCKS pour HTTP et HTTPS


<a name="installation"></a>Installation
------------

Installer avec `npm` :

``` bash
$ npm install agent-base
```


<a name="example"></a>Exemple
-------

Voici un exemple de base qui crée une connexion `net.Socket` au serveur pour chaque requête HTTP (c’est l’équivalent de l’option `agent: false`) :

```js
var net = require('net');
var tls = require('tls');
var url = require('url');
var http = require('http');
var agent = require('agent-base');

var endpoint = 'http://nodejs.org/api/';
var parsed = url.parse(endpoint);

// This is the important part!
parsed.agent = agent(function (req, opts) {
  var socket;
  // `secureEndpoint` is true when using the https module
  if (opts.secureEndpoint) {
    socket = tls.connect(opts);
  } else {
    socket = net.connect(opts);
  }
  return socket;
});

// Everything else works just like normal...
http.get(parsed, function (res) {
  console.log('"response" event!', res.headers);
  res.pipe(process.stdout);
});
```

Le retour d’une promesse ou l’utilisation d’une fonction `async` sont également pris en charge :

```js
agent(async function (req, opts) {
  await sleep(1000);
  // etc…
});
```

Retournez une autre instance `http.Agent` pour « passer » la responsabilité de cette requête HTTP à cet agent :

```js
agent(function (req, opts) {
  return opts.secureEndpoint ? https.globalAgent : http.globalAgent;
});
```


<a name="api"></a>API
---

## <a name="agentfunction-callback-object-options--httpagent"></a>Agent(Function callback[, Object options]) → [http.Agent][]

Crée une base `http.Agent` qui exécute la fonction de rappel `callback` pour chaque requête HTTP utilisée comme `agent`. La fonction de rappel est chargée de créer une instance `stream.Duplex` d’un type quelconque qui sera utilisée comme socket sous-jacent dans la requête HTTP.

L’objet `options` accepte les propriétés suivantes :

  * `timeout` (nombre) : délai d’expiration de la fonction `callback()`, en millisecondes. La valeur par défaut est Infinity (facultatif).

La fonction de rappel doit avoir la signature suivante :

### <a name="callbackhttpclientrequest-req-object-options-function-cb--undefined"></a>callback(http.ClientRequest req, Object options, Function cb) → undefined

Le ClientRequest `req` est accessible pour lire les en-têtes de requête, le chemin, etc. L’objet `options` contient les options passées à l’appel de fonction `http.request()`/`https.request()`, et il est formaté pour être passé directement à `net.connect()`/`tls.connect()`, ou par toute autre manière choisie pour créer un socket. Une fois le socket créé, passez-le à la fonction de rappel `cb`, et la requête HTTP continuera de s’exécuter.

Si le module `https` est utilisé pour appeler la requête HTTP, la propriété `secureEndpoint` sur `options`_sera définie sur`true`_ .


<a name="license"></a>Licence
-------

(Licence MIT)

Copyright (c) 2013 Nathan Rajlich &lt;nathan@tootallnate.net&gt;

Par la présente, l’autorisation est accordée, à titre gracieux, à toute personne obtenant une copie du présent logiciel et des fichiers de documentation associés (le « Logiciel »), de commercialiser le Logiciel sans restriction, dont, sans s’y limiter, le droit d’utiliser, de copier, de modifier, de fusionner, de publier, de distribuer, de concéder sous licence et/ou de vendre des copies du Logiciel, et d’autoriser les personnes à qui le Logiciel est fourni de faire de même, sous réserve des conditions suivantes :

La mention de droits d’auteur ci-dessus et cette autorisation doivent être incluses dans toutes les copies et parties importantes du logiciel.

LE LOGICIEL EST FOURNI « TEL QUEL », SANS GARANTIE D’AUCUNE SORTE, EXPRESSE OU IMPLICITE, NOTAMMENT LES GARANTIES DE QUALITÉ MARCHANDE, D’ADAPTATION À UN USAGE PARTICULIER ET D’ABSENCE DE CONTREFAÇON (LISTE NON EXHAUSTIVE).
LES AUTEURS ET LES DÉTENTEURS DE DROITS D’AUTEUR NE SONT EN AUCUN CAS RESPONSABLES DES RÉCLAMATIONS, DOMMAGES OU AUTRES RESPONSABILITÉS, DANS LE CADRE D’UNE ACTION CONTRACTUELLE, D’UN ACTE DÉLICTUEL OU AUTRE, RÉSULTANT DE OU LIÉS AU LOGICIEL OU À L’UTILISATION DIRECTE OU INDIRECTE DU LOGICIEL.

[http-proxy-agent]: https://github.com/TooTallNate/node-http-proxy-agent
[https-proxy-agent]: https://github.com/TooTallNate/node-https-proxy-agent
[pac-proxy-agent]: https://github.com/TooTallNate/node-pac-proxy-agent
[socks-proxy-agent]: https://github.com/TooTallNate/node-socks-proxy-agent
[http.Agent]: https://nodejs.org/api/http.html#http_class_http_agent
