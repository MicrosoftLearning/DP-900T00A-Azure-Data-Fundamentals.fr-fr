---
ms.openlocfilehash: 34b661fbb1237d51bdab932626d19518225841a0
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051958"
---
<a name="are-we-there-yet"></a>are-we-there-yet
----------------

Effectuez le suivi des hiérarchies complexes des états d’achèvement des tâches asynchrones.  Cela vous permet d’enregistrer et de suivre la progression du grand fan-out récursif et de collecter les workflows de type qui sont très courants dans les tâches asynchrones.

Vous pouvez utiliser ces données d’achèvement comme vous le souhaitez, mais dans le cas d’usage le plus courant, elles servent à alimenter l’un des nombreux modules de barre de progression.

La plupart des modules de barre de progression incluent une version rudimentaire de ces données, mais mes besoins étaient plus complexes.

<a name="usage"></a>Usage
=====

```javascript
var TrackerGroup = require("are-we-there-yet").TrackerGroup

var top = new TrackerGroup("program")

var single = top.newItem("one thing", 100)
single.completeWork(20)

console.log(top.completed()) // 0.2

fs.stat("file", function(er, stat) {
  if (er) throw er  
  var stream = top.newStream("file", stat.size)
  console.log(top.completed()) // now 0.1 as single is 50% of the job and is 20% complete
                              // and 50% * 20% == 10%
  fs.createReadStream("file").pipe(stream).on("data", function (chunk) {
    // do stuff with chunk
  })
  top.on("change", function (name) {
    // called each time a chunk is read from "file"
    // top.completed() will start at 0.1 and fill up to 0.6 as the file is read
  })
})
```

<a name="shared-methods"></a>Méthodes partagées
==============

* var completed = tracker.completed()

Implémenté dans : `Tracker`, `TrackerGroup`, `TrackerStream`

Retourne le pourcentage de travail terminé par rapport au travail restant à effectuer. Plage de 0 à 1.

* tracker.finish()

Implémenté dans : `Tracker`, `TrackerGroup`

Marque le suivi comme terminé. Avec un TrackerGroup, tous ses composants sont marqués comme terminés.

Marque tous les composants de ce suivi comme terminés ; `tracker.completed()` a alors la valeur 1.

Cela entraîne l’émission d’un ou de plusieurs événements `change`.

<a name="events"></a>Événements
======

Tous les objets de suivi émettent des événements `change` avec les arguments suivants :

```
function (name, completed, tracker)
```

`name` est le nom du suivi qui a initialement émis l’événement ou, s’il n’en avait pas, le premier groupe de suivis contenant qui en avait un.

`completed` est le pourcentage terminé (retourné par la méthode `tracker.completed()`).

`tracker` est l’objet de suivi sur lequel vous écoutez les événements.

<a name="trackergroup"></a>TrackerGroup
============

* var tracker = new TrackerGroup(**name**)

  * **name** *(facultatif)* : nom de ce groupe de suivis, qui est utilisé dans les notifications de modification si la mise à jour des composants n’a pas de nom. La valeur par défaut est « non défini ».

Crée un groupe vide d’agrégation de suivis. Il s’agit de suivis dont l’état d’achèvement est déterminé par l’état d’achèvement d’autres suivis.

* tracker.addUnit(**otherTracker**, **weight**)

  * **otherTracker** : tous les autres sont des objets de suivi we-there-yet
  * **weight** *(facultatif)* : poids à donner au suivi ; la valeur par défaut est 1.

Ajoute **otherTracker** à ce groupe d’agrégation. Le poids détermine la durée d’achèvement estimée pour ce suivi par rapport aux autres unités.  Par exemple, si vous ajoutez un suivi avec un poids de 1 et un autre avec un poids de 2, vous supposez que le second prendra deux fois plus de temps que le premier.  Par conséquent, le premier comptera pour 33 % dans l’achèvement de ce suivi et le second comptera pour les 67 % restants.

Retourne **otherTracker**.

* var subGroup = tracker.newGroup(**name**, **weight**)

Ce qui équivaut exactement à :

```javascript
  var subGroup = tracker.addUnit(new TrackerGroup(name), weight)
```

* var subItem = tracker.newItem(**name**, **todo**, **weight**)

Ce qui équivaut exactement à :

```javascript
  var subItem = tracker.addUnit(new Tracker(name, todo), weight)
```

* var subStream = tracker.newStream(**name**, **todo**, **weight**)

Ce qui équivaut exactement à :

```javascript
  var subStream = tracker.addUnit(new TrackerStream(name, todo), weight)
```

* console.log( tracker.debug() )

Retourne une arborescence montrant l’achèvement de ce groupe de suivis et tous ses enfants, y compris l’entrée récursive de tous les enfants.

<a name="tracker"></a>Tracker
=======

* var tracker = new Tracker(**name**, **todo**)

  * **name** *(facultatif)*  : nom de ce compteur à indiquer dans les événements de modification.  La valeur par défaut est « non défini ».
  * **todo** *(facultatif)*  : quantité (nombre) de travail à faire. La valeur par défaut est 0.

Généralement, ces éléments sont construits dans le cadre d’un groupe de suivis (via `newItem`).

* var completed = tracker.completed()

Retourne le pourcentage de travail terminé par rapport au travail restant à effectuer. Plage de 0 à 1. Si le travail total à effectuer est de 0, il retourne 0.

* tracker.addWork(**todo**)

  * **todo** : nombre à ajouter à la quantité de travail à effectuer.

Augmente la quantité de travail à effectuer, ce qui réduit le pourcentage d’achèvement.  Déclenche un événement `change`.

* tracker.completeWork(**completed**)

  * **completed** : nombre à ajouter au travail terminé.

Augmente la quantité de travail terminé, ce qui augmente le pourcentage d’achèvement.
N’augmentera jamais le travail terminé au-delà de la quantité de travail à faire. Autrement dit, les pourcentages > 100 % ne sont pas autorisés. Déclenche un événement `change`.

* tracker.finish()

Marque ce suivi comme terminé. tracker.completed() a maintenant la valeur 1. Déclenche un événement `change`.

<a name="trackerstream"></a>TrackerStream
=============

* var tracker = new TrackerStream(**name**, **size**, **options**)

  * **name** *(facultatif)*  : nom de ce compteur à indiquer dans les événements de modification.  La valeur par défaut est « non défini ».
  * **size** *(facultatif)*  : nombre d’octets envoyés via ce flux.
  * **options** *(facultatif)*  : hachage des options de flux

L’objet de flux de suivi est un flux de transmission qui met à jour un objet de suivi interne chaque fois qu’un bloc est transmis.  Il sert au suivi des téléchargements, de l’extraction des fichiers et d’autres activités connexes. Pour l’utiliser, vous redirigez votre source de données vers cet objet, puis vous l’utilisez comme source de données.

Si vos données ont un attribut de longueur, celui-ci détermine la quantité de travail terminé lorsque le bloc est transmis.  Si ce n’est pas le cas (par exemple, les flux d’objets), chaque bloc compte pour 1 unité de travail, et la taille doit donc être le nombre total d’objets en cours de transmission.

* tracker.addWork(**todo**)

  * **todo** : permet d’augmenter la taille totale attendue en octets **todo**.

Augmente la quantité de travail à effectuer, ce qui réduit le pourcentage d’achèvement.  Déclenche un événement `change`.
