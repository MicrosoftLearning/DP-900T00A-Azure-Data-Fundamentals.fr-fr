---
ms.openlocfilehash: 21db9b7ec97b7028a031a18867aab00575b09850
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053016"
---
# <a name="delayed-stream"></a>delayed-stream

Met en mémoire tampon les événements d’un flux jusqu’à ce que vous soyez prêt à les gérer.

## <a name="installation"></a>Installation

``` bash
npm install delayed-stream
```

## <a name="usage"></a>Usage

L’exemple suivant montre comment écrire un serveur d’écho http qui retarde sa réponse de 1000 ms.

``` javascript
var DelayedStream = require('delayed-stream');
var http = require('http');

http.createServer(function(req, res) {
  var delayed = DelayedStream.create(req);

  setTimeout(function() {
    res.writeHead(200);
    delayed.pipe(res);
  }, 1000);
});
```

Si vous n’utilisez pas `Stream#pipe`, vous pouvez également libérer manuellement les événements mis en mémoire tampon en appelant `delayedStream.resume()` :

``` javascript
var delayed = DelayedStream.create(req);

setTimeout(function() {
  // Emit all buffered events and resume underlaying source
  delayed.resume();
}, 1000);
```

## <a name="implementation"></a>Implémentation

Pour utiliser correctement ce méta flux, voici quelques informations que vous devez connaître concernant l’implémentation.

### <a name="event-buffering--proxying"></a>Mise en mémoire tampon d’événements / proxy

Tous les événements du flux `source` sont détournés en remplaçant la méthode `source.emit`. Jusqu’à ce que Node implémente un écouteur d’événements interceptant tout, il s’agit de la seule manière de procéder.

Toutefois, delayed-stream continue à émettre tous les événements qu’il capture sur la `source`, que vous ayez déjà libéré le flux différé ou non.

Lors de la création, delayed-stream capture tous les événements `source` et les stocke dans une mémoire tampon d’événements interne. Une fois `delayedStream.release()` appelée, tous les événements mis en mémoire tampon sont émis sur le `delayedStream`, et la mémoire tampon d’événements est effacée. Après cela, delayed-stream agit simplement comme un proxy pour la source sous-jacente.

### <a name="error-handling"></a>Gestion des erreurs

Les événements d’erreur sur `source` sont mis en mémoire tampon/proxisés comme tous les autres événements.
Toutefois, `delayedStream.create` attache un écouteur sans opération `'error'` à la `source`. Ainsi, vous devez uniquement gérer les erreurs sur l’objet `delayedStream`, plutôt qu’à deux emplacements.

### <a name="buffer-limits"></a>Limites de mémoire tampon

delayed-stream fournit une propriété `maxDataSize` qui peut être utilisée pour limiter la quantité de données mises en mémoire tampon. Pour vous protéger des flux `source` incorrects qui ne réagissent pas à `source.pause()`, cette fonctionnalité est activée par défaut.

## <a name="api"></a>API

### <a name="delayedstreamcreatesource-options"></a>DelayedStream.create(source, [options])

Retourne un nouvel objet `delayedStream`. Options disponibles :

* `pauseStream`
* `maxDataSize`

Vous trouverez ci-dessous la description de ces propriétés.

### <a name="delayedstreamsource"></a>delayedStream.source

Flux `source` géré par cet objet. Cela est utile si vous transmettez votre `delayedStream` et que vous souhaitez toujours accéder aux propriétés sur l’objet `source`.

### <a name="delayedstreampausestream--true"></a>delayedStream.pauseStream = true

Indique s’il faut suspendre la `source` sous-jacente lors de l’appel à `DelayedStream.create()`. La modification ultérieure de cette propriété n’a aucun effet.

### <a name="delayedstreammaxdatasize--1024--1024"></a>delayedStream.maxDataSize = 1024 * 1024

Quantité de données à mettre en mémoire tampon avant d’émettre une `error`.

Si la source sous-jacente émet des objets `Buffer`, `maxDataSize` fait référence à des octets.

Si la source sous-jacente émet des chaînes JavaScript, la taille fait référence aux caractères.

Si vous savez ce que vous faites, vous pouvez affecter la valeur `Infinity` à cette propriété afin de désactiver cette fonctionnalité. Vous pouvez également modifier cette propriété pendant l’exécution.

### <a name="delayedstreamdatasize--0"></a>delayedStream.dataSize = 0

Quantité de données mises en mémoire tampon jusqu’à présent.

### <a name="delayedstreamreadable"></a>delayedStream.readable

Getter ECMA5 qui retourne la valeur de `source.readable`.

### <a name="delayedstreamresume"></a>delayedStream.resume()

Si le `delayedStream` n’a pas encore été libéré, `delayedStream.release()` est appelée.

Dans les deux cas, `source.resume()` est appelée.

### <a name="delayedstreampause"></a>delayedStream.pause()

Appelle `source.pause()`.

### <a name="delayedstreampipedest"></a>delayedStream.pipe(dest)

Appelle `delayedStream.resume()`, puis proxise les arguments vers `source.pipe`.

### <a name="delayedstreamrelease"></a>delayedStream.release()

Émet et efface tous les événements qui ont été mis en mémoire tampon jusqu’à présent. Cela n’entraîne pas la reprise de la source sous-jacente ; utilisez `delayedStream.resume()` à la place.

## <a name="license"></a>Licence

delayed-stream est concédé sous licence MIT.
