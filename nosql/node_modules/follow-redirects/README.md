---
ms.openlocfilehash: aa7ddb2f2ce7709064cf5157f709fc1eff52cff7
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051641"
---
## <a name="follow-redirects"></a>Suivre les redirections

Remplacement pour les modules `http` et `https` de principale qui suit automatiquement les redirections.

[![Version npm](https://img.shields.io/npm/v/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![État de la build](https://github.com/follow-redirects/follow-redirects/workflows/CI/badge.svg)](https://github.com/follow-redirects/follow-redirects/actions)
[![État de couverture](https://coveralls.io/repos/follow-redirects/follow-redirects/badge.svg?branch=master)](https://coveralls.io/r/follow-redirects/follow-redirects?branch=master)
[![Téléchargements npm](https://img.shields.io/npm/dm/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![Sponsor sur GitHub](https://img.shields.io/static/v1?label=Sponsor&message=%F0%9F%92%96&logo=GitHub)](https://github.com/sponsors/RubenVerborgh)

`follow-redirects` fournit des méthodes [request](https://nodejs.org/api/http.html#http_http_request_options_callback) et [get](https://nodejs.org/api/http.html#http_http_get_options_callback) qui se comportent de la même façon que celles trouvées sur les modules [http](https://nodejs.org/api/http.html#http_http_request_options_callback) et [https](https://nodejs.org/api/https.html#https_https_request_options_callback) natifs, hormis le fait qu’elles suivront en toute transparence les redirections.

```javascript
const { http, https } = require('follow-redirects');

http.get('http://bit.ly/900913', response => {
  response.on('data', chunk => {
    console.log(chunk);
  });
}).on('error', err => {
  console.error(err);
});
```

Vous pouvez inspecter l’URL redirigée finale via la propriété `responseUrl` sur la `response`.
Si aucune redirection n’a eu lieu, `responseUrl` correspond à l’URL de requête d’origine.

```javascript
const request = https.request({
  host: 'bitly.com',
  path: '/UHfDGO',
}, response => {
  console.log(response.responseUrl);
  // 'http://duckduckgo.com/robots.txt'
});
request.end();
```

## <a name="options"></a>Options
### <a name="global-options"></a>Options globales
Les options globales sont définies directement sur le module `follow-redirects` :

```javascript
const followRedirects = require('follow-redirects');
followRedirects.maxRedirects = 10;
followRedirects.maxBodyLength = 20 * 1024 * 1024; // 20 MB
```

Les options globales suivantes sont prises en charge :

- `maxRedirects` (par défaut : `21`) : définit le nombre maximal de redirections autorisées ; si ce chiffre est dépassé, une erreur est émise.

- `maxBodyLength` (par défaut : 10 Mo : définit la taille maximale du corps de requête ; si ce chiffre est dépassé, une erreur est émise.

### <a name="per-request-options"></a>Options par requête
Les options par requête sont définies en passant un objet `options` :

```javascript
const url = require('url');
const { http, https } = require('follow-redirects');

const options = url.parse('http://bit.ly/900913');
options.maxRedirects = 10;
options.beforeRedirect = (options, { headers }) => {
  // Use this to adjust the request options upon redirecting,
  // to inspect the latest response headers,
  // or to cancel the request by throwing an error
  if (options.hostname === "example.com") {
    options.auth = "user:password";
  }
};
http.request(options);
```

Outre les [options HTTPS](https://nodejs.org/api/http.html#http_http_request_options_callback) et [HTTP standard](https://nodejs.org/api/https.html#https_https_request_options_callback), les options par requête suivantes sont prises en charge :
- `followRedirects` (par défaut : `true`) : indique si les redirections doivent être suivies.

- `maxRedirects` (par défaut : `21`) : définit le nombre maximal de redirections autorisées ; si ce chiffre est dépassé, une erreur est émise.

- `maxBodyLength` (par défaut : 10 Mo : définit la taille maximale du corps de requête ; si ce chiffre est dépassé, une erreur est émise.

- `beforeRedirect` (par défaut : `undefined`) : si vous le souhaitez, modifiez la requête `options` sur les redirections ou abandonnez la requête en levant une erreur.

- `agents` (par défaut : `undefined`) : définit l’option `agent` par protocole, car HTTP et HTTPS utilisent différents agents. Exemple de valeur : `{ http: new http.Agent(), https: new https.Agent() }`

- `trackRedirects` (par défaut : `false`) : indique s’il faut stocker les détails de la réponse redirigée dans le tableau `redirects` sur l’objet de réponse.


### <a name="advanced-usage"></a>Utilisation avancée
Par défaut, `follow-redirects` utilise les implémentations par défaut Node.js de [`http`](https://nodejs.org/api/http.html) et [`https`](https://nodejs.org/api/https.html).
Pour activer des fonctionnalités telles que la mise en cache et/ou le suivi des requêtes intermédiaires, vous pouvez à la place wrapper `follow-redirects` autour d’implémentations de protocoles personnalisés :

```javascript
const { http, https } = require('follow-redirects').wrap({
  http: require('your-custom-http'),
  https: require('your-custom-https'),
});
```

Ces protocoles personnalisés n’ont besoin que d’une implémentation de la méthode `request`.

## <a name="browser-usage"></a>Utilisation du navigateur

En raison du fonctionnement du navigateur, les équivalents `http` et `https` du navigateur effectuent des redirections par défaut.

En exigeant `follow-redirects` de cette manière :
```javascript
const http = require('follow-redirects/http');
const https = require('follow-redirects/https');
```
Vous pouvez facilement indiquer à webpack et à vos amis de remplacer `follow-redirect` par les versions intégrées :

```json
{
  "follow-redirects/http"  : "http",
  "follow-redirects/https" : "https"
}
```

## <a name="contributing"></a>Contribution

Les demandes de tirage sont toujours les bienvenues. Veuillez [soumettre un problème](https://github.com/follow-redirects/follow-redirects/issues) détaillant votre proposition avant d’investir votre temps précieux. Les fonctionnalités supplémentaires et correctifs de bogues doivent être accompagnés de tests. Vous pouvez exécuter la suite de tests localement avec une commande `npm test` simple.

## <a name="debug-logging"></a>Journalisation du débogage

`follow-redirects` utilise l’excellent [debug](https://www.npmjs.com/package/debug) pour la journalisation. Pour activer la journalisation, définissez la variable d’environnement `DEBUG=follow-redirects` pour la sortie de débogage de ce module uniquement. Lors de l’exécution de la suite de tests, il est parfois avantageux de définir `DEBUG=*` afin d’afficher également la sortie du serveur express.

## <a name="authors"></a>Auteurs

- [Ruben Verborgh](https://ruben.verborgh.org/)
- [Olivier Lalonde](mailto:olalonde@gmail.com)
- [James Talmage](mailto:james@talmage.io)

## <a name="license"></a>Licence

[Licence MIT](https://github.com/follow-redirects/follow-redirects/blob/master/LICENSE)
