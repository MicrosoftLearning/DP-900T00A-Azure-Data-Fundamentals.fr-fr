---
ms.openlocfilehash: 7a40bb5c1f9bdc59490cf2a2dbf591d14b488b41
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051369"
---
# <a name="form-data-npm-modulehttpswwwnpmjscompackageform-data-join-the-chat-at-httpsgitterimform-dataform-datahttpsgitterimform-dataform-data"></a>Form-Data [![Module NPM](https://img.shields.io/npm/v/form-data.svg)](https://www.npmjs.com/package/form-data) [![Rejoignez la conversation à l’adresse https://gitter.im/form-data/form-data](http://form-data.github.io/images/gitterbadge.svg)](https://gitter.im/form-data/form-data)

Bibliothèque pour créer des flux ```"multipart/form-data"``` lisibles. Peut être utilisée pour envoyer des formulaires et des chargements de fichiers à d’autres applications web.

L’API de cette bibliothèque est inspirée de l’[interface XMLHttpRequest-2 FormData][xhr2-fd].

[xhr2-fd]: http://dev.w3.org/2006/webapi/XMLHttpRequest-2/Overview.html#the-formdata-interface

[![Build Linux](https://img.shields.io/travis/form-data/form-data/v3.0.1.svg?label=linux:6.x-12.x)](https://travis-ci.org/form-data/form-data)
[![Build MacOS](https://img.shields.io/travis/form-data/form-data/v3.0.1.svg?label=macos:6.x-12.x)](https://travis-ci.org/form-data/form-data)
[![Build Windows](https://img.shields.io/travis/form-data/form-data/v3.0.1.svg?label=windows:6.x-12.x)](https://travis-ci.org/form-data/form-data)

[![État de couverture](https://img.shields.io/coveralls/form-data/form-data/v3.0.1.svg?label=code+coverage)](https://coveralls.io/github/form-data/form-data?branch=master)
[![État des dépendances](https://img.shields.io/david/form-data/form-data.svg)](https://david-dm.org/form-data/form-data)

## <a name="install"></a>Installer

```
npm install --save form-data
```

## <a name="usage"></a>Usage

Dans cet exemple, nous construisons un formulaire avec trois champs qui contiennent une chaîne, une mémoire tampon et un flux de fichier.

``` javascript
var FormData = require('form-data');
var fs = require('fs');

var form = new FormData();
form.append('my_field', 'my value');
form.append('my_buffer', new Buffer(10));
form.append('my_file', fs.createReadStream('/foo/bar.jpg'));
```

Vous pouvez également utiliser le flux de réponse http-response :

``` javascript
var FormData = require('form-data');
var http = require('http');

var form = new FormData();

http.request('http://nodejs.org/images/logo.png', function(response) {
  form.append('my_field', 'my value');
  form.append('my_buffer', new Buffer(10));
  form.append('my_logo', response);
});
```

Ou encore le flux [request](https://github.com/request/request) de @mikeal :

``` javascript
var FormData = require('form-data');
var request = require('request');

var form = new FormData();

form.append('my_field', 'my value');
form.append('my_buffer', new Buffer(10));
form.append('my_logo', request('http://nodejs.org/images/logo.png'));
```

Pour soumettre ce formulaire à une application web, appelez la méthode ```submit(url, [callback])``` :

``` javascript
form.submit('http://example.org/', function(err, res) {
  // res – response object (http.IncomingMessage)  //
  res.resume();
});

```

Pour les manipulations de requête plus avancées, la méthode ```submit()``` retourne un objet ```http.ClientRequest```, ou bien vous pouvez choisir parmi l’une des méthodes de soumission alternatives.

### <a name="custom-options"></a>Options personnalisées

Vous pouvez fournir des options personnalisées, telles que `maxDataSize` :

``` javascript
var FormData = require('form-data');

var form = new FormData({ maxDataSize: 20971520 });
form.append('my_field', 'my value');
form.append('my_buffer', /* something big */);
```

La liste des options disponibles est disponible dans [combined-stream](https://github.com/felixge/node-combined-stream/blob/master/lib/combined_stream.js#L7-L15).

### <a name="alternative-submission-methods"></a>Méthodes de soumission alternatives

Vous pouvez utiliser l’interface client http de Node :

``` javascript
var http = require('http');

var request = http.request({
  method: 'post',
  host: 'example.org',
  path: '/upload',
  headers: form.getHeaders()
});

form.pipe(request);

request.on('response', function(res) {
  console.log(res.statusCode);
});
```

Ou si vous préférez que l’en-tête `'Content-Length'` soit défini pour vous :

``` javascript
form.submit('example.org/upload', function(err, res) {
  console.log(res.statusCode);
});
```

Pour utiliser des en-têtes personnalisés et une longueur prédéfinie dans les parties :

``` javascript
var CRLF = '\r\n';
var form = new FormData();

var options = {
  header: CRLF + '--' + form.getBoundary() + CRLF + 'X-Custom-Header: 123' + CRLF + CRLF,
  knownLength: 1
};

form.append('my_buffer', buffer, options);

form.submit('http://example.com/', function(err, res) {
  if (err) throw err;
  console.log('Done');
});
```

Form-Data peut reconnaître et extraire toutes les informations requises à partir de types courants de flux (```fs.readStream```, ```http.response``` et ```mikeal's request```). Pour certains autres types de flux, vous devrez fournir manuellement des informations liées au fichier :

``` javascript
someModule.stream(function(err, stdout, stderr) {
  if (err) throw err;

  var form = new FormData();

  form.append('file', stdout, {
    filename: 'unicycle.jpg', // ... or:
    filepath: 'photos/toys/unicycle.jpg',
    contentType: 'image/jpeg',
    knownLength: 19806
  });

  form.submit('http://example.com/', function(err, res) {
    if (err) throw err;
    console.log('Done');
  });
});
```

La propriété `filepath` substitue `filename` et peut contenir un chemin relatif. Elle est généralement utilisée lors du chargement de [plusieurs fichiers à partir d’un répertoire](https://wicg.github.io/entries-api/#dom-htmlinputelement-webkitdirectory).

Pour les cas de périphérie, comme une requête POST à une URL avec chaîne de requête ou pour transmettre des informations d’identification d’authentification HTTP, l’objet peut être passé à `form.submit()` en guise de premier paramètre :

``` javascript
form.submit({
  host: 'example.com',
  path: '/probably.php?extra=params',
  auth: 'username:password'
}, function(err, res) {
  console.log(res.statusCode);
});
```

Si vous devez également envoyer des en-têtes HTTP personnalisés avec la requête POST, vous pouvez utiliser la clé `headers` dans le premier paramètre de `form.submit()` :

``` javascript
form.submit({
  host: 'example.com',
  path: '/surelynot.php',
  headers: {'x-test-header': 'test-header-value'}
}, function(err, res) {
  console.log(res.statusCode);
});
```

### <a name="methods"></a>Méthodes

- [_Void_ append( **String** _field_, **Mixed** _value_ [, **Mixed** _options_] )](https://github.com/form-data/form-data#void-append-string-field-mixed-value--mixed-options-).
- [_Headers_ getHeaders( [**Headers** _userHeaders_] )](https://github.com/form-data/form-data#array-getheaders-array-userheaders-)
- [_String_ getBoundary()](https://github.com/form-data/form-data#string-getboundary)
- [_Void_ setBoundary()](https://github.com/form-data/form-data#void-setboundary)
- [_Buffer_ getBuffer()](https://github.com/form-data/form-data#buffer-getbuffer)
- [_Integer_ getLengthSync()](https://github.com/form-data/form-data#integer-getlengthsync)
- [_Integer_ getLength( **function** _callback_ )](https://github.com/form-data/form-data#integer-getlength-function-callback-)
- [_Boolean_ hasKnownLength()](https://github.com/form-data/form-data#boolean-hasknownlength)
- [_Request_ submit( _params_, **function** _callback_ )](https://github.com/form-data/form-data#request-submit-params-function-callback-)
- [_String_ toString()](https://github.com/form-data/form-data#string-tostring)

#### <a name="_void_-append-string-_field_-mixed-_value_--mixed-_options_-"></a>_Void_ append( **String** _field_, **Mixed** _value_ [, **Mixed** _options_] )
Ajouter des données au formulaire. Vous pouvez soumettre n’importe quel format (chaîne, entier, booléen, mémoire tampon, etc.). Toutefois, les tableaux ne sont pas pris en charge et doivent être transformés en chaînes par l’utilisateur.
```javascript
var form = new FormData();
form.append( 'my_string', 'my value' );
form.append( 'my_integer', 1 );
form.append( 'my_boolean', true );
form.append( 'my_buffer', new Buffer(10) );
form.append( 'my_array_as_json', JSON.stringify( ['bird','cute'] ) )
```

Vous pouvez fournir une chaîne pour les options, ou un objet.
```javascript
// Set filename by providing a string for options
form.append( 'my_file', fs.createReadStream('/foo/bar.jpg'), 'bar.jpg' );

// provide an object.
form.append( 'my_file', fs.createReadStream('/foo/bar.jpg'), {filename: 'bar.jpg', contentType: 'image/jpeg', knownLength: 19806} );
```

#### <a name="_headers_-getheaders-headers-_userheaders_-"></a>_Headers_ getHeaders( [**Headers** _userHeaders_] )
Cette méthode ajoute l’en-tête `content-type` correct au tableau fourni de `userHeaders`.  

#### <a name="_string_-getboundary"></a>_String_ getBoundary()
Retourne la limite du formData. Par défaut, la limite se compose de 26 `-` suivis de 24 nombres, par exemple :
```javascript
--------------------------515890814546601021194782
```

#### <a name="_void_-setboundarystring-_boundary_"></a>_Void_ setBoundary(String _boundary_)
Définir la chaîne de limite, remplaçant le comportement par défaut décrit ci-dessus.

_Remarque : La limite doit être unique et peut ne pas apparaître dans les données._

#### <a name="_buffer_-getbuffer"></a>_Buffer_ getBuffer()
Retourner le package de demande de formulaire complet, en tant que mémoire tampon. Vous pouvez insérer cette mémoire tampon par exemple dans Axios pour envoyer des données multipart.
```javascript
var form = new FormData();
form.append( 'my_buffer', Buffer.from([0x4a,0x42,0x20,0x52,0x6f,0x63,0x6b,0x73]) );
form.append( 'my_file', fs.readFileSync('/foo/bar.jpg') );

axios.post( 'https://example.com/path/to/api',
            form.getBuffer(),
            form.getHeaders()
          )
```
**Remarque :** Étant donné que la sortie est de type Buffer, vous ne pouvez ajouter que des types acceptés par Buffer : *string, Buffer, ArrayBuffer, Array, ou objet de type Array*. Un ReadStream, par exemple, entraîne une erreur.

#### <a name="_integer_-getlengthsync"></a>_Integer_ getLengthSync()
Identique à `getLength` mais synchrone.

_Remarque : getLengthSync ne calcule __pas__ la longueur des flux._

#### <a name="_integer_-getlength-function-_callback_-"></a>_Integer_ getLength( **function** _callback_ )
Retourne le `Content-Length` async. Le rappel est utilisé pour gérer les erreurs et continuer une fois la longueur calculée.
```javascript
this.getLength(function(err, length) {
  if (err) {
    this._error(err);
    return;
  }

  // add content length
  request.setHeader('Content-Length', length);

  ...
}.bind(this));
```

#### <a name="_boolean_-hasknownlength"></a>_Boolean_ hasKnownLength()
Vérifie si la longueur des valeurs ajoutées est connue.

#### <a name="_request_-submit-_params_-function-_callback_-"></a>_Request_ submit( _params_, **function** _callback_ )
Envoyer le formulaire à une application web.
```javascript
var form = new FormData();
form.append( 'my_string', 'Hello World' );

form.submit( 'http://example.com/', function(err, res) {
  // res – response object (http.IncomingMessage)  //
  res.resume();
} );
```

#### <a name="_string_-tostring"></a>_String_ toString()
Retourne les données de formulaire sous forme de chaîne. N’utilisez pas cela si vous envoyez des fichiers ou des mémoires tampons ; utilisez `getBuffer()` à la place.

### <a name="integration-with-other-libraries"></a>Intégration à d’autres bibliothèques

#### <a name="request"></a>Requête

Soumission de formulaire à l’aide de [request](https://github.com/request/request) :

```javascript
var formData = {
  my_field: 'my_value',
  my_file: fs.createReadStream(__dirname + '/unicycle.jpg'),
};

request.post({url:'http://service.com/upload', formData: formData}, function(err, httpResponse, body) {
  if (err) {
    return console.error('upload failed:', err);
  }
  console.log('Upload successful!  Server responded with:', body);
});
```

Pour plus d’informations, consultez [Readme request](https://github.com/request/request#multipartform-data-multipart-form-uploads).

#### <a name="node-fetch"></a>node-fetch

Vous pouvez également envoyer un formulaire à l’aide de [node-fetch](https://github.com/bitinn/node-fetch) :

```javascript
var form = new FormData();

form.append('a', 1);

fetch('http://example.com', { method: 'POST', body: form })
    .then(function(res) {
        return res.json();
    }).then(function(json) {
        console.log(json);
    });
```

#### <a name="axios"></a>axios

Dans Node.js vous pouvez publier un fichier à l’aide d’[axios](https://github.com/axios/axios) :
```javascript
const form = new FormData();
const stream = fs.createReadStream(PATH_TO_FILE);

form.append('image', stream);

// In Node.js environment you need to set boundary in the header field 'Content-Type' by calling method `getHeaders`
const formHeaders = form.getHeaders();

axios.post('http://example.com', form, {
  headers: {
    ...formHeaders,
  },
})
.then(response => response)
.catch(error => error)
```

## <a name="notes"></a>Notes

- La méthode ```getLengthSync()``` ne calcule PAS la longueur des flux ; utilisez les options ```knownLength``` comme solution de contournement.
- À compter de la version `2.x`, FormData a supprimé la prise en charge de `node@0.10.x`.
- À compter de la version `3.x`, FormData a supprimé la prise en charge de `node@4.x`.

## <a name="license"></a>Licence

Form-Data est publié sous licence [MIT](License).
