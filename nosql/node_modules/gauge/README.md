---
ms.openlocfilehash: 81fd1455668c9343defe69cbbbff10d48b1f97ef
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051913"
---
<a name="gauge"></a>jauge
=====

Jauge horizontale / barre de progression presque sans état et basée sur un terminal.

```javascript
var Gauge = require("gauge")

var gauge = new Gauge()

gauge.show("test", 0.20)

gauge.pulse("this")

gauge.hide()
```

![](gauge-demo.gif)


### <a name="changes-from-1x"></a>CHANGEMENTS PAR RAPPORT À 1.x

Gauge 2.x est une version avec changement cassant. Consultez le [changelog] pour plus d’informations sur ce qui a changé si vous utilisiez auparavant ce module.

[journal des modifications]: CHANGELOG.md

### <a name="the-gauge-class"></a>CLASSE GAUGE

Il s’agit de l’interface classique du module : elle fournit une jolie interface de type « tire et oublie » pour afficher vos informations d’état.

```
var Gauge = require("gauge")

var gauge = new Gauge([stream], [options])
```

* **stream** : *(facultatif, STDERR par défaut)* Flux dans lequel les mises à jour de barre de progression doivent être écrites.  La jauge respecte la régulation du flux, et suspend la plupart des écritures si cela est indiqué.
* **options** : *(facultatif)* Objet d’option.

Construit une nouvelle jauge. Les jauges sont dessinées sur une seule ligne, et ne sont pas dessinées si **stream** n’est pas un tty et qu’un tty n’est pas fourni explicitement.

Si **stream** est un terminal ou si vous transmettez **tty** à **options**, nous détecterons les redimensionnements de terminal et redessinerons pour adapter.  Nous surveillons pour cela les événements `resize` sur le tty.  (Pour contourner un bogue dans les versions de Node antérieures à 2.5.0, nous les surveillons sur stdout si le tty est stderr.) Les redimensionnements à des tailles de fenêtre supérieures seront propres, mais le rétrécissement de la fenêtre entraîne toujours la présence de débris.

**IMPORTANT :** Si vous passiez auparavant un flux non-tty, mais que vous souhaitez toujours générer une sortie (par exemple un flux encapsulé par le module `ansi`), vous devez passer l’option **tty** ci-dessous, car `gauge` doit accéder au tty sous-jacent afin d’effectuer des opérations telles que les redimensionnements de terminal et la détection de largeur de terminal.

L’objet **options** peut avoir les propriétés suivantes, toutes facultatives :

* **updateInterval** : fréquence à laquelle les mises à jour de jauge doivent être dessinées, en secondes.
* **fixedFramerate** : la valeur par défaut est false sur le nœud 0.8, true sur tout le reste.  Lorsque la valeur est true, un minuteur est créé pour se déclencher toutes les `updateInterval` ms. Lorsqu’elle est false, les mises à jour sont imprimées dès qu’elles arrivent, mais les mises à jour ayant lieu plus souvent que `updateInterval` sont ignorées.  La raison pour laquelle 0.8 n’a pas cette valeur définie sur true est qu’il ne peut pas `unref` son minuteur, et que cela empêcherait donc votre programme de quitter. Si vous souhaitez utiliser cette fonctionnalité avec 0.8, veillez simplement à appeler `gauge.disable()` avant le moment où vous vous attendez à ce que votre programme se quitte.
* **themes** : ensemble de thèmes à utiliser lors de la sélection du thème à utiliser. La valeur par défaut est `gauge/themes`. Pour plus d’informations, consultez la documentation sur [themes].
* **theme** : sélectionnez un thème à utiliser. Il peut s’agir :
  * D’un objet theme, auquel cas **themes** n’est pas utilisé.
  * Du nom d’un thème, qui sera recherché dans l’objet *themes* actif.
  * D’un objet de configuration avec des clés `hasUnicode`, `hasColor` ou `platform`, qui sera utilisé pour remplacer nos estimations lors d’une sélection de thème par défaut.

  Si aucun thème n’est sélectionné, une valeur par défaut est choisie à l’aide d’une combinaison de nos meilleures estimations en fonction de votre système d’exploitation, de la prise en charge des couleurs et de la prise en charge unicode.
* **template** : décrit ce à quoi votre jauge doit ressembler.  La valeur par défaut est ce que npm utilise.  La [documentation] détaillée se trouve plus loin dans ce document.
* **hideCursor** : est true par défaut.  Si la valeur est true, le curseur est masqué pendant l’affichage de la jauge.
* **tty** : le tty dans lequel vous écrivez.  La valeur par défaut est la même que celle de **stream**.  Sert à détecter la largeur du terminal et les redimensionnements. La largeur utilisée est `tty.columns - 1`. Si aucun tty n’est disponible, une largeur `79` est supposée.
* **enabled** : la valeur par défaut est true si `tty` est un TTY, false dans le cas contraire.  Si la valeur est true, la jauge démarre en étant activée.  Si cette option est désactivée, toutes les commandes de mise à jour sont ignorées et aucune jauge n’est imprimée tant que vous n’avez pas appelé `.enable()`.
* **Plumbing** : classe à utiliser pour générer concrètement la jauge pour l’impression.  La valeur par défaut est `require('gauge/plumbing')`, et vous n’aurez normalement pas besoin de remplacer cette valeur.
* **cleanupOnExit** : est true par défaut. En règle générale, nous inscrivons un gestionnaire de sortie pour veiller à ce que votre curseur soit réactivé et que la barre de progression soit effacée lorsque votre processus quitte, même si vous quittez avec Ctrl-C ou de manière inattendue. Vous pouvez désactiver cette option, auquel cas elle n’inscrit pas le gestionnaire de sortie.

[has-unicode]: https://www.npmjs.com/package/has-unicode
[themes]: #themes
[documentation]: #templates

#### `gauge.show(section | status, [completed])`

Le premier argument est la section, le nom de l’élément actuel contribuant à la progression ou un objet avec des clés telles que **section**, **subsection** & **completed** (ou toutes autres pour lesquelles vous avez des types dans un modèle personnalisé).  Si vous ne souhaitez pas mettre à jour ou définir l’un de ces éléments, vous pouvez passer `null` et il sera ignoré.

Le deuxième argument est le pourcentage terminé sous la forme d’une valeur comprise entre 0 et 1.
Sans lui, l’achèvement n’est tout simplement pas mis à jour. Vous remarquerez également que l’achèvement peut être passé dans le cadre d’un objet d’état comme premier argument. Si ce dernier et l’argument d’achèvement sont tous deux transmis, c’est l’argument d’achèvement qui l’emporte.

#### `gauge.hide([cb])`

Supprime la jauge du terminal.  Si vous le souhaitez, rappelez `cb` après que l’E/S a eu l’occasion de se produire (à l’heure actuelle, cela signifie juste après le rappel de `setImmediate`.)

Cela s’avère important lorsque vous suspendez la barre de progression sur un filehandle et que vous imprimez sur un autre. Autrement (avec un grand nombre d’impressions), le nœud peut finir par imprimer les bits de « barre de progression de fin » dans le filehandle de la barre de progression tandis que d’autres éléments sont imprimés dans un autre filehandle. Ces entrelacements peuvent provoquer une corruption dans certains terminaux.

#### `gauge.pulse([subsection])`

* **subsection** : *(facultatif)* Élément spécifique qui a déclenché cette impulsion

Fait tourner la boucle de progression dans la jauge pour afficher la sortie.  Si **subsection** est incluse, elle sera combinée avec le dernier nom passé à `gauge.show`.

#### `gauge.disable()`

Masque la jauge et ignore les appels ultérieurs à `show` ou `pulse`.

#### `gauge.enable()`

Affiche la jauge et reprend la mise à jour quand `show` ou `pulse` est appelée.

#### `gauge.isEnabled()`

Retourne la valeur true si la jauge est activée.

#### `gauge.setThemeset(themes)`

Change l’ensemble de thèmes à partir duquel sélectionner un thème. Identique à l’option `themes` utilisée dans le constructeur. Le thème sera resélectionné à partir de cet ensemble de thèmes.

#### `gauge.setTheme(theme)`

Change le thème actif. Sera affiché avec le prochain affichage ou la prochaine impulsion. Il peut s’agir des ordinateurs suivants :

* D’un objet theme, auquel cas **themes** n’est pas utilisé.
* Du nom d’un thème, qui sera recherché dans l’objet *themes* actif.
* D’un objet de configuration avec des clés `hasUnicode`, `hasColor` ou `platform`, qui sera utilisé pour remplacer nos estimations lors d’une sélection de thème par défaut.

Si aucun thème n’est sélectionné, une valeur par défaut est choisie à l’aide d’une combinaison de nos meilleures estimations en fonction de votre système d’exploitation, de la prise en charge des couleurs et de la prise en charge unicode.

#### `gauge.setTemplate(template)`

Change le modèle actif. Sera affiché avec le prochain affichage ou la prochaine impulsion.

### <a name="tracking-completion"></a>Suivi de l’achèvement

Si vous avez plusieurs choses en cours dont vous souhaitez suivre l’achèvement, vous trouverez peut-être utiles les éléments connexes [are-we-there-yet].  Son événement `change` peut être câblé à la méthode `show` pour obtenir une interface de barre de progression plus traditionnelle.

[are-we-there-yet]: https://www.npmjs.com/package/are-we-there-yet

### <a name="themes"></a>THEMES

```
var themes = require('gauge/themes')

// fetch the default color unicode theme for this platform
var ourTheme = themes({hasUnicode: true, hasColor: true})

// fetch the default non-color unicode theme for osx
var ourTheme = themes({hasUnicode: true, hasColor: false, platform: 'darwin'})

// create a new theme based on the color ascii theme for this platform
// that brackets the progress bar with arrows
var ourTheme = themes.newTheme(theme(hasUnicode: false, hasColor: true}), {
  preProgressbar: '→',
  postProgressbar: '←'
})
```

L’objet retourné par `gauge/themes` est une instance de la classe `ThemeSet`.

```
var ThemeSet = require('gauge/theme-set')
var themes = new ThemeSet()
// or
var themes = require('gauge/themes')
var mythemes = themes.newThemeset() // creates a new themeset based on the default themes
```

#### <a name="themesopts"></a>themes(opts)
#### <a name="themesgetdefaultopts"></a>themes.getDefault(opts)

Les objets de thème sont une fonction qui extrait le thème par défaut en fonction de la plateforme et de la prise en charge des couleurs et d’unicode.

Options est un objet avec les propriétés suivantes :

* **hasUnicode** : si la valeur est true, extraire un thème unicode. Si aucun thème unicode n’est disponible, un thème non unicode sera utilisé.
* **hasColor** : si la valeur est true, extraire un thème de couleur. Si aucun thème de couleur n’est disponible, un thème sans couleur sera utilisé.
* **platform** (facultatif) : la valeur par défaut est `process.platform`.  Si aucune correspondance de plateforme n’est disponible, `fallback` est utilisé à la place.

Si aucun thème compatible n’est trouvé, une erreur est levée avec le `code` `EMISSINGTHEME`.

#### <a name="themesaddthemethemename-themeobj"></a>themes.addTheme(themeName, themeObj)
#### <a name="themesaddthemethemename-parenttheme-newtheme"></a>themes.addTheme(themeName, [parentTheme], newTheme)

Ajoute un thème nommé à l’ensemble de thèmes.  Vous pouvez passer un objet de thème, tel que retourné par `themes.newTheme`, ou les arguments que vous passeriez à `themes.newTheme`.

#### <a name="themesgetthemenames"></a>themes.getThemeNames()

Retourne une liste de tous les noms des thèmes de cet ensemble de thèmes. Peut être utilisé dans `themes.getTheme(…)`.

#### <a name="themesgetthemename"></a>themes.getTheme(name)

Retourne l’objet de thème de cet ensemble de thèmes nommé `name`.

Si `name` n’existe pas dans cet ensemble de thèmes, une erreur est levée avec le `code` `EMISSINGTHEME`.

#### <a name="themessetdefaultopts-themename"></a>themes.setDefault([opts], themeName)

`opts` est un objet avec les propriétés suivantes.

* **platform** : la valeur par défaut est `'fallback'`.  Si votre thème est propre à la plateforme, précisez cela ici avec la plateforme de `process.platform`, par exemple `win32`, `darwin`, et ainsi de suite.
* **hasUnicode** : la valeur par défaut est `false`. Si votre thème utilise unicode, vous devez définir cette valeur sur true.
* **hasColor** : la valeur par défaut est `false`.  Si votre thème utilise la couleur, vous devez définir cette valeur sur true.

`themeName` est le nom du thème (tel que donné à `addTheme`) à utiliser pour cet ensemble de `opts`.

#### <a name="themesnewthemeparenttheme-newtheme"></a>themes.newTheme([parentTheme,] newTheme)

Crée un objet de thème basé sur `parentTheme`.  Si aucun `parentTheme` n’est fourni, un parentTheme minimal qui définit les fonctions pour le rendu de l’indicateur d’activité (boucle de progression) et la barre de progression sera défini. (Ce parent de secours est défini dans `gauge/base-theme`.)

newTheme doit être un objet nu : nous commencerons par discuter des propriétés définies par les thèmes par défaut :

* **preProgressbar** : affichée avant la barre de progression, si celle-ci est affichée.
* **postProgressbar** : affichée après la barre de progression, si celle-ci est affichée.
* **progressBarTheme** : sous-thème transmis au renderer de barre de progression. Il s’agit d’un objet avec des propriétés `complete` et `remaining` qui sont les chaînes que vous souhaitez répéter pour ces sections de la barre de progression.
* **activityIndicatorTheme** : thème pour l’indicateur d’activité (boucle de progression). Il peut s’agir soit d’une chaîne, dans laquelle chaque caractère est une étape différente, soit d’un tableau de chaînes.
* **preSubsection** : affichée sous la forme d’un séparateur entre `section` et `subsection` quand celle-ci est imprimée.

Plus généralement, les thèmes peuvent avoir n’importe quelle valeur qui serait une valeur valide lors du rendu des modèles. Les propriétés du thème sont utilisées lorsque leur nom correspond à un type dans le modèle. Leurs valeurs peuvent être :

* **Des chaînes et des nombres** : ils seront inclus tels quels.
* **Une fonction (valeurs, thème, largeur)**  : doit retourner ce que vous souhaitez dans votre sortie.
  *valeurs* est un objet avec des valeurs fournies via `gauge.show`, *thème* est le thème propre à cet élément (voir ci-dessous) ou cet objet de thème, et *largeur* est la largeur en caractères que votre résultat doit faire.

Il existe quelques préfixes spéciaux :

* **pre** : est affiché avant la propriété, si elle est affichée.
* **post** : est affiché après la propriété, si elle est affichée.

Et un suffixe spécial :

* **Theme** : sa valeur est passée à un élément de type de fonction comme thème.

#### <a name="themesaddtoallthemestheme"></a>themes.addToAllThemes(theme)

Ceci *combine* `theme` dans tous les thèmes actuellement définis. Cela l’ajoute également au thème parent par défaut pour cet ensemble de thèmes ; ainsi, les thèmes ultérieurs ajoutés à cet ensemble de thèmes obtiendront les valeurs de `theme` par défaut.

#### <a name="themesnewthemeset"></a>themes.newThemeset()

Copier l’ensemble de thèmes actuel dans un nouveau.  Cela vous permet d’hériter facilement d’un ensemble de thèmes vers un autre.

### <a name="templates"></a>TEMPLATES

Un modèle est un tableau d’objets et de chaînes qui, après avoir été évalué, sera transformé en ligne de jauge.  Le modèle par défaut est :

```javascript
[
    {type: 'progressbar', length: 20},
    {type: 'activityIndicator', kerning: 1, length: 1},
    {type: 'section', kerning: 1, default: ''},
    {type: 'subsection', kerning: 1, default: ''}
]
```

Les différents éléments de modèle peuvent être des **chaînes brutes**, auquel cas elles seront incluses verbatim dans la sortie, ou des objets avec les propriétés suivantes :

* *type* peut être l’un des éléments suivants plus toute clé que vous transmettez dans `gauge.show`, plus toute clé que vous avez sur un thème personnalisé.
  * `section` : la chose sur laquelle vous travaillez actuellement.
  * `subsection` : le composant de cette chose qui fonctionne actuellement.
  * `activityIndicator` : affiche une boucle de progression à l’aide du `activityIndicatorTheme` de votre thème actif.
  * `progressbar` : barre de progression représentant votre `completed` actif à l’aide du `progressbarTheme` de votre thème actif.
* *kerning* : nombre d’espaces qu’il doit y avoir entre cet élément et d’autres éléments, si cet élément est affiché.
* *maxLength* : longueur maximale de cet élément. Si sa valeur est plus longue, elle sera tronquée.
* *minLength* : longueur minimale de cet élément. Si sa valeur est plus courte, elle sera remplie en fonction de la valeur *align*.
* *align* : (par défaut : left) les valeurs possibles sont « left », « right » et « center ». Fonctionne comme tout processeur de texte.
* *length* : fournit une valeur unique pour *minLength* et *maxLength*. Si *length* et *minLength ou *maxLength* sont spécifiées, cette dernière est prioritaire.
* *value* : valeur littérale à utiliser pour cet élément de modèle.
* *default* : valeur par défaut à utiliser pour cet élément de modèle si aucune valeur n’a été transmise.

### <a name="plumbing"></a>PLUMBING

Il s’agit du mécanisme interne, ultra simple et sans aucune magie, utilisé par gauge pour implémenter son interface ordinaire.

```
var Plumbing = require('gauge/plumbing')
var gauge = new Plumbing(theme, template, width)
```

* **theme** : thème à utiliser.
* **template** : modèle à utiliser.
* **width** : largeur souhaitée de votre jauge.

#### `gauge.setTheme(theme)`

Changer le thème actif.

#### `gauge.setTemplate(template)`

Changer le modèle actif.

#### `gauge.setWidth(width)`

Changer la largeur d’affichage.

#### `gauge.hide()`

Retourne la chaîne nécessaire pour masquer la barre de progression.

#### `gauge.hideCursor()`

Retourne une chaîne pour masquer le curseur.

#### `gauge.showCursor()`

Retourne une chaîne pour afficher le curseur.

#### `gauge.show(status)`

En utilisant `status` pour les valeurs, afficher le modèle fourni avec le thème et retourner une chaîne qui convient à l’impression pour mettre à jour la jauge.
