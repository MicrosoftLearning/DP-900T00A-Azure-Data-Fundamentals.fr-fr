---
ms.openlocfilehash: 50690c00791b1f6ca1d585c1fb653f0ec4794578
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051705"
---
# <a name="prebuild-install"></a>prebuild-install

> **Outil en ligne de commande permettant d’installer facilement des fichiers binaires prédéfinis pour plusieurs versions de Node.js et Electron sur une plateforme spécifique.**
> Par défaut, il télécharge les fichiers binaires prédéfinis à partir d’une version GitHub.

[![npm](https://img.shields.io/npm/v/prebuild-install.svg)](https://www.npmjs.com/package/prebuild-install)
![version de nœud](https://img.shields.io/node/v/prebuild-install.svg)
[![Test](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml/badge.svg)](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml)
[![david](https://david-dm.org/prebuild/prebuild-install.svg)](https://david-dm.org/prebuild/prebuild-install)
[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com/)

## <a name="note"></a>Remarque

**Au lieu d’associer [`prebuild`](https://github.com/prebuild/prebuild) à [`prebuild-install`](https://github.com/prebuild/prebuild-install), nous vous recommandons d’associer [`prebuildify`](https://github.com/prebuild/prebuildify) à [`node-gyp-build`](https://github.com/prebuild/node-gyp-build).**

Avec `prebuildify`, tous les fichiers binaires prédéfinis sont expédiés à l’intérieur du package publié sur npm, ce qui signifie qu’il n’est pas nécessaire d’effectuer une étape de téléchargement distincte comme dans `prebuild`. L’ironie de cette approche est qu’il est plus rapide de télécharger tous les fichiers binaires prédéfinis pour chaque plateforme lorsqu’ils sont regroupés, que de télécharger un seul fichier binaire prédéfini en tant que script d’installation.

Avantages :

1. Aucune étape de téléchargement supplémentaire, ce qui rend l’installation plus fiable et plus rapide.
2. Prend en charge la modification des versions du runtime localement et l’utilisation d’une même installation sur Node.js et Electron. Il n’est pas nécessaire d’effectuer une réinstallation ou une regénération, car tous les fichiers binaires prédéfinis se trouvent dans le tarball npm, et le bon fichier sera choisi au moment de l’exécution.
3. La dépendance de runtime `node-gyp-build` est sans dépendance, et elle le restera par principe, car l’introduction de dépendances annulerait la durée d’installation la plus courte.
4. Les fichiers binaires prédéfinis fonctionnent même si les scripts d’installation npm sont désactivés.
5. La somme de contrôle du package npm couvre également les fichiers binaires prédéfinis.

Inconvénients :

1. Le package npm installé est plus volumineux sur le disque. L’utilisation de [Node-API](https://nodejs.org/api/n-api.html) atténue ce problème, car les fichiers binaires Node-API sont indépendants du runtime et offrent une compatibilité ascendante.
2. Leur publication est un peu plus compliquée, car `npm publish` doit être effectué après la compilation et la récupération des fichiers binaires prédéfinis (généralement dans le cadre d’une intégration continue).

## <a name="usage"></a>Usage

Utilisez [`prebuild`](https://github.com/prebuild/prebuild) pour créer et charger des fichiers binaires prédéfinis. Remplacez ensuite le script d’installation package.json par :

```json
{
  "scripts": {
    "install": "prebuild-install || node-gyp rebuild"
  }
}
```

### <a name="help"></a>Aide

```
prebuild-install [options]

  --download    -d  [url]       (download prebuilds, no url means github)
  --target      -t  version     (version to install for)
  --runtime     -r  runtime     (Node runtime [node, napi or electron] to build or install for, default is node)
  --path        -p  path        (make a prebuild-install here)
  --token       -T  gh-token    (github token for private repos)
  --arch            arch        (target CPU architecture, see Node OS module docs, default is current arch)
  --platform        platform    (target platform, see Node OS module docs, default is current platform)
  --tag-prefix <prefix>         (github tag prefix, default is "v")
  --build-from-source           (skip prebuild download)
  --verbose                     (log verbosely)
  --libc                        (use provided libc rather than system default)
  --debug                       (set Debug or Release configuration)
  --version                     (print prebuild-install version and exit)
```

Quand `prebuild-install` est exécuté via un `npm` script, les options `--build-from-source`, `--debug`, `--download`, `--target`, `--runtime`, `--arch` et `--platform` peuvent être passées via des arguments donnés à la commande `npm`.

L’autre possibilité consiste à définir les variables d’environnement `npm_config_build_from_source=true`, `npm_config_platform`, `npm_config_arch`, `npm_config_target` et `npm_config_runtime`.

### <a name="private-repositories"></a>Dépôts privés

`prebuild-install` prend en charge le téléchargement des prébuilds à partir de dépôts GitHub privés à l’aide de `-T <github-token>` :

```
$ prebuild-install -T <github-token>
```

Si vous ne souhaitez pas utiliser le jeton dans l’interface CLI, vous pouvez le placer dans `~/.prebuild-installrc` :

```
token=<github-token>
```

Vous pouvez également le spécifier dans la variable d’environnement `prebuild-install_token`.

Notez que l’utilisation d’un jeton GitHub nécessite l’utilisation de l’API pour résoudre la version correcte, ce qui signifie que vous êtes soumis à la [limite de débit GitHub](https://developer.github.com/v3/rate_limit/).

### <a name="create-github-token"></a>Créer un jeton GitHub

Pour créer un jeton :

- Accédez à [cette page](https://github.com/settings/tokens).
- Cliquez sur le bouton `Generate new token`.
- Donnez un nom au jeton et cliquez sur le bouton `Generate token` (voir ci-dessous)

![prebuild-token](https://cloud.githubusercontent.com/assets/13285808/20844584/d0b85268-b8c0-11e6-8b08-2b19522165a9.png)

Les étendues par défaut doivent convenir.

### <a name="custom-binaries"></a>Fichiers binaires personnalisés

L’utilisateur final peut remplacer l’emplacement de téléchargement des fichiers binaires par le biais de variables d’environnement dans son fichier .npmrc.
La variable doit correspondre au masque `% your package name %_binary_host` ou `% your package name %_binary_host_mirror`. Par exemple :

```
leveldown_binary_host=http://overriden-host.com/overriden-path
```

Notez que le sous-chemin de version du package et le nom de fichier sont toujours ajoutés.
Par conséquent, si vous installez `leveldown@1.2.3`, l’URL obtenue sera :

```
http://overriden-host.com/overriden-path/v1.2.3/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

#### <a name="local-prebuilds"></a>Prébuilds locaux

Si vous souhaitez utiliser des prébuilds de votre système de fichiers local, vous pouvez utiliser la variable .npmrc `% your package name %_local_prebuilds` pour définir un chemin de dossier contenant les prébuilds. Par exemple :

```
leveldown_local_prebuilds=/path/to/prebuilds
```

Cette option recherche directement dans ce dossier les bundles créés avec `prebuild`, par exemple :

```
/path/to/prebuilds/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

Les chemins non absolus sont résolus par rapport au répertoire du package qui appelle prebuild-install, par exemple, pour des dépendances imbriquées.

### <a name="cache"></a>Cache

Tous les fichiers binaires prédéfinis sont mis en cache pour réduire le trafic. `prebuild-install` commence donc par sélectionner des fichiers binaires dans le cache, et si aucun fichier binaire n’est trouvé, il les télécharge. Selon l’environnement, le dossier du cache est déterminé dans l’ordre suivant :

- `${npm_config_cache}/_prebuilds`
- `${APP_DATA}/npm-cache/_prebuilds`
- `${HOME}/.npm/_prebuilds`

## <a name="license"></a>Licence

MIT
