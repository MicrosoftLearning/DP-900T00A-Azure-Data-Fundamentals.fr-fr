---
ms.openlocfilehash: 4f70d9e1d8895757244ec8464f178ff3068a36bd
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051083"
---
# <a name="rc"></a>rc

Chargeur de configuration non configurable pour personnes paresseuses.

## <a name="usage"></a>Usage

La seule option consiste à passer le nom de votre application à rc, ainsi que votre configuration par défaut.

```javascript
var conf = require('rc')(appname, {
  //defaults go here.
  port: 2468,

  //defaults which are objects will be merged, not replaced
  views: {
    engine: 'jade'
  }
});
```

`rc` retournera vos options de configuration fusionnées avec les options par défaut que vous spécifiez.
Si vous passez un objet par défaut prédéfini, celui-ci sera muté :

```javascript
var conf = {};
require('rc')(appname, conf);
```

Si `rc` trouve des fichiers de configuration pour votre application, l’objet config retourné aura un tableau `configs` contenant leurs chemins :

```javascript
var appCfg = require('rc')(appname, conf);
appCfg.configs[0] // /etc/appnamerc
appCfg.configs[1] // /home/dominictarr/.config/appname
appCfg.config // same as appCfg.configs[appCfg.configs.length - 1]
```

## <a name="standards"></a>Standards

Étant donné le nom de votre application (`appname`), rc recherchera la configuration dans tous les emplacements évidents.

  * Des arguments de ligne de commande, analysés par minimist _(par exemple `--foo baz`, également imbriqué : `--foo.bar=baz`)_
  * Des variables d’environnement avec `${appname}_` comme préfixe
    * ou utilisez "\_\_" pour indiquer les propriétés imbriquées <br/> _(par exemple, `appname_foo__bar__baz` => `foo.bar.baz`)_
  * Si vous avez passé une option `--config file` à partir de ce fichier
  * Un `.${appname}rc` local ou le premier trouvé dans `./ ../ ../../ ../../../`.
  * `$HOME/.${appname}rc`
  * `$HOME/.${appname}/config`
  * `$HOME/.config/${appname}`
  * `$HOME/.config/${appname}/config`
  * `/etc/${appname}rc`
  * `/etc/${appname}/config`
  * L’objet par défaut que vous avez passé.

Toutes les sources de configuration trouvées sont aplaties en un seul objet, de sorte que les sources **antérieures** de cette liste remplaceront les sources ultérieures.


## <a name="configuration-file-formats"></a>Formats des fichiers de configuration

Les fichiers de configuration (par exemple `.appnamerc`) peuvent être au format [json](http://json.org/example) ou [ini](http://en.wikipedia.org/wiki/INI_file). **Aucune** extension de fichier (`.json` ou `.ini`) ne doit être utilisée. Les exemples de configurations ci-dessous sont équivalents :


#### <a name="formatted-as-ini"></a>Au format `ini`

```
; You can include comments in `ini` format if you want.

dependsOn=0.10.0


; `rc` has built-in support for ini sections, see?

[commands]
  www     = ./commands/www
  console = ./commands/repl


; You can even do nested sections

[generators.options]
  engine  = ejs

[generators.modules]
  new     = generate-new
  engine  = generate-backend

```

#### <a name="formatted-as-json"></a>Au format `json`

```javascript
{
  // You can even comment your JSON, if you want
  "dependsOn": "0.10.0",
  "commands": {
    "www": "./commands/www",
    "console": "./commands/repl"
  },
  "generators": {
    "options": {
      "engine": "ejs"
    },
    "modules": {
      "new": "generate-new",
      "backend": "generate-backend"
    }
  }
}
```

Les commentaires sont supprimés de la configuration JSON via [strip-json-comments](https://github.com/sindresorhus/strip-json-comments).

> Étant donné que les variables ini et env n’ont pas de standard pour les types, votre application doit être préparée pour les chaînes.

Pour être sûr que les représentations sous forme de chaînes des valeurs booléennes et des nombres seront toujours converties dans le type approprié (ce qui est particulièrement utile si vous prévoyez d’effectuer des comparaisons `===` strictes), vous pouvez utiliser un module comme [parse-strings-in-object](https://github.com/anselanza/parse-strings-in-object) pour wrapper l’objet config retourné par rc.


## <a name="simple-example-demonstrating-precedence"></a>Exemple simple illustrant le concept de priorité
Supposons que vous disposiez d’une application comme celle-ci (notez les valeurs par défaut codées en dur qui sont passées à rc) :
```
const conf = require('rc')('myapp', {
    port: 12345,
    mode: 'test'
});

console.log(JSON.stringify(conf, null, 2));
```
Vous disposez également d’un fichier `config.json`, avec ce contenu :
```
{
  "port": 9000,
  "foo": "from config json",
  "something": "else"
}
```
Et d’un fichier `.myapprc` dans le même dossier, avec le contenu suivant :
```
{
  "port": "3001",
  "foo": "bar"
}
```
Voici la sortie attendue de différentes commandes :

`node .`
```
{
  "port": "3001",
  "mode": "test",
  "foo": "bar",
  "_": [],
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc"
  ],
  "config": "/Users/stephen/repos/conftest/.myapprc"
}
```
*Le `mode` par défaut de l’objet codé en dur est conservé, mais le port est remplacé par le fichier `.myapprc` (trouvé automatiquement d’après la correspondance avec appname) et `foo` est ajouté.*


`node . --foo baz`
```
{
  "port": "3001",
  "mode": "test",
  "foo": "baz",
  "_": [],
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc"
  ],
  "config": "/Users/stephen/repos/conftest/.myapprc"
}
```
*Même résultat que ci-dessus, mais `foo` est substitué, car les arguments de ligne de commande sont prioritaires par rapport au fichier `.myapprc`.*

`node . --foo barbar --config config.json`
```
{
  "port": 9000,
  "mode": "test",
  "foo": "barbar",
  "something": "else",
  "_": [],
  "config": "config.json",
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc",
    "config.json"
  ]
}
```
*À présent, `port` vient du fichier `config.json` spécifié (remplaçant la valeur de `.myapprc`), et la valeur `foo` est remplacée par la ligne de commande, même si elle est également spécifiée dans le fichier `config.json`.*
 


## <a name="advanced-usage"></a>Utilisation avancée

#### <a name="pass-in-your-own-argv"></a>Passer votre propre `argv`

Vous pouvez passer votre propre `argv` comme troisième argument de `rc`.  Ceci vous servira si vous souhaitez [utiliser votre propre analyseur de ligne de commande](https://github.com/dominictarr/rc/pull/12).

```javascript
require('rc')(appname, defaults, customArgvParser);
```

## <a name="pass-in-your-own-parser"></a>Passer votre propre analyseur

Si vous avez besoin d’utiliser un analyseur non standard, vous pouvez le faire en passant l’analyseur comme 4e argument
(laissez le 3e comme Null pour obtenir l’analyseur d’arguments par défaut).

```javascript
require('rc')(appname, defaults, null, parser);
```

Cela peut également être utilisé pour forcer un format plus strict, comme un format JSON valide uniquement.

## <a name="note-on-performance"></a>Remarque sur les performances

`rc` est en cours d’exécution `fs.statSync`. Veillez donc à ne pas l’utiliser dans un chemin de code chaud (par exemple, un gestionnaire de requêtes) 


## <a name="license"></a>Licence

Multilicence : concédé sous la licence BSD à deux clauses, la licence MIT ou la licence Apache version 2.0
